{% extends 'questionnaire/analytics/base.html' %}
{% load app_filters %}


{% block title %}Worker sentiment analytics{% endblock %}
{% block body_class %}worker-sentiment analytics-page{% endblock %}

{% block content %}
    <div class="row"><h3 class="text-center base-title">Workers Sentiment Analytics</h3></div>
    <div class="row">
        <div class="col-xs-12">
             <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active">
                    <a href="#detailed-results" aria-controls="detailed-results" role="tab" data-toggle="tab">Detailed Results</a>
                </li>
                <li role="presentation">
                    <a href="#statistical-data" aria-controls="statistical-data" role="tab" data-toggle="tab">Statistical Data</a>
                </li>
                <li role="presentation">
                    <a href="#performance-indicators" aria-controls="performance-indicators" role="tab" data-toggle="tab">Performance Indicators</a>
                </li>
             </ul>
        </div>
    </div>

    <div class="tab-content">
        <div role="tabpanel" class="row tab-pane active" id="detailed-results">
            <div class="col-xs-12">
                <h4>
                <span>
                    Detailed Results
                </span>
                <div class="pull-right">
                    <span class="select-header">Select a Campaign:</span>
                    <select id="table-campaign-filter" class="col-xs-4">
                        <option></option>
                        {% for campaign in campaigns %}
                            <option data-val="{{ campaign.name }}">{{ campaign.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                </h4>

                <div class="col-xs-12">
                    <span class="select-header">Select a User type:</span>
                    <select id="table-type-filter" class="col-xs-4">
                        <option data-val="">All</option>
                        <option data-val="Worker">Worker</option>
                        <option data-val="Manager">Manager</option>
                        <option data-val="Visitor">Visitor</option>
                    </select>

                    <span class="select-header">Select a Questionnaire part:</span>
                    <select id="table-choice" class="pull-right">
                        <option>Physical Perceptions: Part I.1</option>
                        <option>Physical Perceptions: Part I.2</option>
                        <option>Physical Perceptions: Part I.3</option>
                    </select>

                </div>
                <table id="detailed-results-part-1" class="analytics-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Campaign</th>
                            <th>Temperature</th>
                            <th>Humidity</th>
                            <th>Acoustics</th>
                            <th>Natural Light</th>
                            <th>Interior Lighting</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for answer_group in grouped_answers_part_1 %}
                        {% with campaign=answer_group.0.get_campaign %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td class="subject-type">{{ answer_group.0.subject.type }}</td>
                                <td>{{ answer_group.0.answered_at|date:"d/m/Y" }}</td>
                                <td class="campaign-name">{{ campaign }}</td>

                                {% for answer in answer_group %}
                                    {% with answer_text=answer.get_answer_text %}
                                    <td {% if answer_text|contains:"not suitable" %}class="negative"
                                        {% elif answer_text|contains:"suitable" %}class="positive"
                                        {% elif answer_text|contains:"neither" %}class="neutral"
                                        {% endif %}
                                    >

                                        {{ answer_text }}
                                    </td>
                                    {% endwith %}
                                {% endfor %}

                            </tr>
                        {% endwith %}
                    {% endfor %}
                    </tbody>
                </table>

                <table id="detailed-results-part-2" class="analytics-table hidden">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Campaign</th>
                            <th>Table</th>
                            <th>Chair</th>
                            <th>Bookcases</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for answer_group in grouped_answers_part_2 %}
                        {% with campaign=answer_group.0.get_campaign %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td class="subject-type">{{ answer_group.0.subject.type }}</td>
                                <td>{{ answer_group.0.answered_at|date:"d/m/Y" }}</td>
                                <td class="campaign-name">{{ campaign }}</td>

                                {% for answer in answer_group %}
                                    {% with answer_text=answer.get_answer_text %}
                                    <td {% if answer_text|contains:"not suitable" %}class="negative"
                                        {% elif answer_text|contains:"suitable" %}class="positive"
                                        {% elif answer_text|contains:"neither" %}class="neutral"
                                        {% endif %}
                                    >

                                        {{ answer_text }}
                                    </td>
                                    {% endwith %}
                                {% endfor %}

                            </tr>
                        {% endwith %}
                    {% endfor %}
                    </tbody>
                </table>

                <table id="detailed-results-part-3" class="analytics-table hidden">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Campaign</th>
                            <th>Degree of Fatigue</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for answer_group in grouped_answers_part_3 %}
                        {% with campaign=answer_group.0.get_campaign %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td class="subject-type">{{ answer_group.0.subject.type }}</td>
                                <td>{{ answer_group.0.answered_at|date:"d/m/Y" }}</td>
                                <td class="campaign-name">{{ campaign }}</td>

                                {% for answer in answer_group %}
                                    {% with answer_text=answer.get_answer_text %}
                                    <td {% if answer_text|contains:"rest" %}class="negative"
                                        {% elif answer_text|contains:"working" %}class="positive"
                                        {% elif answer_text|contains:"neither" %}class="neutral"
                                        {% endif %}
                                    >

                                        {{ answer_text }}
                                    </td>
                                    {% endwith %}
                                {% endfor %}

                            </tr>
                        {% endwith %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div role="tabpanel" class="row tab-pane"  id="statistical-data">
            <div class="col-xs-12">
                <h4>
                <span>
                    Statistical Data
                </span>
                <div class="pull-right">
                    <span class="select-header">Select a Questionnaire part:</span>
                    <select id="chart-choice" class="pull-right">
                        <option>Physical Perceptions: Part I.1</option>
                        <option>Physical Perceptions: Part I.2</option>
                        <option>Physical Perceptions: Part I.3</option>
                        <option>Emotional & Behavioural: Part II.1</option>
                        <option>Emotional & Behavioural: Part II.2</option>
                    </select>
                </div>
                </h4>
                <div class="col-xs-12" style="margin-bottom: 2em">
                        <div class="pull-left">
                            <span class="select-header">Select a User type:</span>
                            <select id="chart-subject-type-filter">
                                <option data-val="">All</option>
                                <option value="worker" data-varname="type">Worker</option>
                                <option value="manager" data-varname="type">Manager</option>
                                <option value="visitor" data-varname="type">Visitor</option>
                            </select>
                        </div>
                        <div class="pull-left">
                            <span class="select-header">Select a Campaign:</span>
                            <select id="chart-campaign-filter">
                                <option></option>
                                {% for campaign in campaigns %}
                                    <option value="{{ campaign.pk }}" data-varname="campaign">{{ campaign.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="pull-left">
                            <label for="chart-unique-answers-filter" class="pull-left">Answers are unique:</label>
                            <input id="chart-unique-answers-filter" data-varname="unique" type="checkbox" class="icheck pull-left"/>
                        </div>
                    </div>
                <div class="col-sm-6 col-xs-12" style="padding-left: 0;padding-right: 30px;">
                    <div id="chartContainer"></div>
                </div>
                <div class="col-sm-6 col-xs-12" style="padding-left: 25px;">
                    <div class="row">
                        <div class="main-stat col-xs-12" style="border: none;">
                            <div class="col-xs-12" style="padding-left:0; padding-right: 0; margin-bottom: 25px;">
                                <div class="col-xs-4"><span id="number-of-workers"></span>% Workers </div>
                                <div class="col-xs-4"><span id="number-of-managers"></span>% Managers</div>
                                <div class="col-xs-4"><span id="number-of-visitors"></span>% Visitors</div>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="dictContainer">

                    </div>
                    <div class="row">
                        <div class="likert-stats row" style="margin-left:0">
                            <div class="title col-xs-12">Questionnaire Part Responders</div>
                            <div class="col-xs-12">
                                <span class="col-xs-6">Total:</span>
                                <span class="col-xs-6" id="number-of-responses"></span>
                            </div>
                            <div class="col-xs-12">
                                <span class="col-xs-6">Unique:</span>
                                <span class="col-xs-6" id="number-of-unique-responses"></span>
                            </div>
                        </div>
                        <div class="row" id="statsContainer">

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="row tab-pane" id="performance-indicators">
            <div class="col-xs-12">
                <h4>
                    <span>
                        Performance Indicators
                    </span>
                    <div class="pull-right">
                        <span class="select-header">Select a Questionnaire part:</span>
                        <select id="performance-indicator-choice" class="pull-right">
                            <option>Physical Perceptions: Part I.1</option>
                            <option>Physical Perceptions: Part I.2</option>
                            <option>Physical Perceptions: Part I.3</option>
                            <option>Emotional & Behavioural: Part II.1</option>
                            <option>Emotional & Behavioural: Part II.2</option>
                        </select>
                    </div>
                </h4>

                <div class="col-xs-12">
                    Some KPIs to show
                </div>

        </div>
    </div>



{% endblock %}